#define DEBUG_MODE

#include "Communication.h"

int Main() {
	LuaState LuaState;

	InitConsole();

	print(Colors::Red, "Getting environment ready...\n");
	luaState = Offsets::scriptContext::luastate(LuaState.getScriptContext());

	print(Colors::Cyan, "Setting exploit level to 8...\n");
	Misc::setlevel(luaState, 8);

    print(Colors::Green, "Loaded Slxp!\n");

#ifdef DEBUG_MODE
    while (true) {
		std::string source;
		Execution Execution;

        print(Colors::White, " Enter your script below :\n");

        std::getline(std::cin, source);
        Execution.Execute_Script(luaState, source);
    }
#else
        CreateThread(NULL, NULL, InitPipe, NULL, NULL, NULL);
#endif
}

BOOL APIENTRY DllMain(HMODULE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved) {
	switch (ul_reason_for_call) {
	case DLL_PROCESS_ATTACH:
		CreateThread(NULL, NULL, (LPTHREAD_START_ROUTINE)(Main), NULL, NULL, NULL);
		break;
	}
	return TRUE;
}

