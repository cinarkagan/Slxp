#include "Api.h"

DWORD WINAPI InitPipe([[unused]] LPVOID Param) {
	const auto Pipe = CreateNamedPipe("\\\\.\\pipe\\Slobby Xploits", PIPE_ACCESS_DUPLEX | PIPE_TYPE_BYTE | PIPE_READMODE_BYTE, PIPE_WAIT, 1, 1024, 1024, NMPWAIT_USE_DEFAULT_WAIT, NULL);

	while (Pipe != INVALID_HANDLE_VALUE) {
		if (ConnectNamedPipe(Pipe, NULL)) {
			std::string Script;
			Execution Execution;

			DWORD Read;
			char buffer[1024]{};

			while (ReadFile(Pipe, buffer, 1024, &Read, NULL))
				Script.append(buffer, Read);
			Execution.Execute_Script(luaState, Script);
		}
		DisconnectNamedPipe(Pipe);
	}
}