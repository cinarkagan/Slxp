#pragma once

#include <Windows.h>
#include <iostream>

const uintptr_t base = reinterpret_cast<uintptr_t>(GetModuleHandle(NULL));

namespace Addresses {
	using luavm_load = uintptr_t(__fastcall*)(uintptr_t rl, std::string* source, const char* chunk, int env);
	luavm_load r_luavm_load = (luavm_load)(base + 0x356B40);

	using task_defer = uintptr_t(__cdecl*)(uintptr_t rl);
	task_defer r_taskdefer = (task_defer)(base + 0x3DC560);

	using getscheduler = uintptr_t(__cdecl*)();
	getscheduler r_getscheduler = (getscheduler)(base + 0x7320B0);

	using print = uintptr_t(__cdecl*)(int type, const char* source);
	print r_print = (print)(base + 0xCEE9C0);
}

namespace Offsets {
	namespace scriptContext {
		uintptr_t luastate(uintptr_t sc) {
			return *reinterpret_cast<uintptr_t*>(sc + 244) ^ (sc + 244);
		}
	}
	namespace lua_State {
		const uintptr_t top = 12;
		const uintptr_t extraSpace = 72;

		void incrementTop(uintptr_t rl) {
			*reinterpret_cast<uintptr_t*>(rl + top) += 16;//1 integer = 16bits
		}

		void decrementTop(uintptr_t rl) {
			*reinterpret_cast<uintptr_t*>(rl + top) -= 16;//1 integer = 16bits
		}
	}
	namespace extra_Space {
		const uintptr_t identity = 24;
	}
	namespace global_State {
		uintptr_t global(uintptr_t rl) {
			return *reinterpret_cast<uintptr_t*>(rl + 8) - (rl + 8);
		}
	}
}